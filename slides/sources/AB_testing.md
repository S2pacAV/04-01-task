---
marp: true


# Define title slide
_class: invert
_backgroundColor: #4520ab;
_paginate: skip;
_footer: 
# _header: "![](https://elbrusboot.camp/static/newLogo-00ed4b8011624cd94aa1812d35f25088.svg)"

math: katex
---

<style>
img[alt~="center"] {
  display: block;
  margin: 0 auto;
}
h1 {
  position: absolute;
  left: 77px;
  top: 20px;
  right: 80px;
  height: 70px;
  line-height: 70px;
  margin-bottom: 20px;
  color: #4520ab;
  font-size: 28pt
}

a {
  color: #4520ab;
}
</style>

# Фаза 1 • Неделя 1 • Четверг

##  A/B тесты 


---

<!--- backgroundColor: white --->
<!--- paginate: true --->
<!-- header: "![](aux/Elbrus-bootcamp-RU.png)" -->

<style>
header {
    height: 675px;
    right: 20px;
    /* margin-bottom: 80px; */
}
header img {
    height: 60px;
    float: right;
 }
</style>

# Сегодня


* Что же такое A/B тесты
* Важные моменты 
* достоинства и недостатки A/B тестов


---

# Мощность в А/B тестировании

>Давайте вспомним что такое мощность критерия?


Что влияет на мощность?

• Разные статистические критерии имеют разную мощность, нужно пробовать

• Величина эффекта — эффект, который мы хотим зарегестрировать. Чем больше эффект, тем больше мощность

• Количество наблюдений — чем больше наблюдений, тем легче зарегистрировать изменения в силу ЦПТ.

• Размер дисперсии - Можем ли мы как то влиять на него?

--- 

# Мощность в А/B тестировании

Вспоминая формулу доверительного интервала, можно увидеть влияние

$$(\bar{x} - \dfrac{s}{\sqrt{n}}t_{\alpha}(n-1)); (\bar{x} + \dfrac{s}{\sqrt{n}}t_{\alpha}(n-1))$$


Как можно уменьшить доверительный интервал?

---

# CUPED

__CUPED (Controlled-experiment Using Pre-Experiment Data)__ — очень популярный в последнее время метод уменьшения вариации. Основная идея метода такова: давайте вычтем что-то из теста и из контроля так, чтобы математическое ожидание разницы новых величин осталось таким же, как было, а дисперсия уменьшилась.

$T' = T - \theta \cdot A$
$C' = C - \theta \cdot B$  

A и B — некоторые случайные величины (ковариаты). Тогда утверждается, что если θ будет такой, как указано в формулах далее, то дисперсия будет минимально возможной для таких статистик.

---

# CUPED

$\theta = \dfrac{cov(T, A) + cov(C, B)}{DA + DB}$

Формула дисперсии примет вид:

$D(T' - C') = (1 - \alpha^2) \cdot D(T - C)$,

где $\alpha = corr(T-C, A-B)$

$A$ и $B$ чаще всего берут значения той же метрики на предэкспериментальном периоде. Например, вы смотрите метрику выручки, тогда в роли ковариаты A и B можно взять выручку от пользователя за месяц до начала эксперимента. Чем хорош такой способ. 

---

# Бутстреп

Бутстреп (bootstrap) - это метод для оценки стандартных отклонений и нахождения доверительных интервалов статистических функционалов.

В качестве оценки функции распределения будем использовать эмпирическую функцию распределения (ЭФР). ЭФР является несмещённой оценкой и сходится к истинной ФР при увеличении размера выборки.

---

# Бутстреп

* Генерируем пару подвыборок того же размера из исходных данных контрольной и экспериментальной групп;

* Считаем метрики (реализация оценки метрики) для каждой из групп;

* Вычисляем разность метрик, сохраняем полученное значение;

* Повторяем шаги 1-3 от 1000 до 10000 раз;

* Строим доверительный интервал с уровнем значимости \alpha;

* Если 0 не принадлежит ДИ, то отличия статистически значимы на уровне значимости \alpha, иначе нет. 


---

# Стратификация


Логика стратифицирования очень простая, если у нас есть какой-то признак, который делит наших пользователей таким образом, что исследуемая метрика у этих страт различна, ты мы хотим сохранить пропорцию и при делении на контроль и тест





